<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>How to use the R package 'Landmarking' • Landmarking</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="How to use the R package 'Landmarking'">
<meta property="og:description" content="Landmarking">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-standard navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Landmarking</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Landmarking.html">Introduction to Landmark Models and the R package Landmarking</a>
    </li>
    <li>
      <a href="../articles/how_to_use.html">How to use the R package 'Landmarking'</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://https://github.com/isobelbarrott/Landmarking/" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
    github
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="how_to_use_files/header-attrs-2.11/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>How to use the R package ‘Landmarking’</h1>
                        <h4 data-toc-skip class="author">Isobel Barrott</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/isobelbarrott/Landmarking/blob/master/../Landmarking/vignettes/how_to_use.Rmd" class="external-link"><code>../Landmarking/vignettes/how_to_use.Rmd</code></a></small>
      <div class="hidden name"><code>how_to_use.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor" aria-hidden="true"></a>Introduction</h2>
<p>Below is a step-by-step demonstration of how to use this package. This example looks at using risk assessments recorded at primary care practices to predict the 5-year risk of cardiovascular disease (CVD).</p>
<p>We will perform the landmarking analysis using both the LOCF and LME methods and compare the results of these two models. The example involves competing risks events in the form of the risk of death from other causes; the cause-specific model will therefore be used as the survival submodel. For more information about the landmark model please see isobelbarrott.github.io/Landmarking.</p>
</div>
<div id="exploring-the-datasets" class="section level2">
<h2 class="hasAnchor">
<a href="#exploring-the-datasets" class="anchor" aria-hidden="true"></a>Exploring the datasets</h2>
<p>First of all, let’s take a look at the dataset we are going to analyse. This dataset is a combination of two datasets: one of these contains the longitudinal (repeat measures) data and one of these contains the time-to-event data.</p>
<ul>
<li><p>The longitudinal (repeat measurements) data from CVD risk assessments is in long format. Each row corresponds to a different assessment and an individual may have multiple assessments. The dataset contains information about an individual’s ethnicity, smoking status, diabetes, and standardised systolic blood pressure (SBP). These were recorded at the patient age specified in <code>response_time_sbp_stnd</code>. The standardised total cholesterol to high density lipoprotein (HDL) ratio was also recorded as part of the assessment but was recorded at the patient age specified in <code>response_time_tchdl_stnd</code>, which is up to a month after the other variables were measured.</p></li>
<li><p>The time-to-event data indicates the time and status of event that each individual experiences. There are three types of events: censoring (this is due to loss to follow-up or the end of the study, indicated by status <code>0</code>), CVD event (indicated by status <code>1</code>), or death from other causes (indicated by status <code>2</code>). It is important when using this package that 0 is used to indicate censoring, 1 to indicate the event of interest, and values 2 or above indicate different competing risks.</p></li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/isobelbarrott/Landmarking/" class="external-link">Landmarking</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">data_repeat_outcomes</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_repeat_outcomes</span><span class="op">)</span>
<span class="co">#&gt;   id smoking diabetes ethnicity        dob index   sbp_stnd   tchdl_stnd</span>
<span class="co">#&gt; 1  1       0        0  European 1957-03-26     1  0.6083674  0.462541398</span>
<span class="co">#&gt; 2  2       0        0  European 1952-11-12     1 -0.6701342  0.005126055</span>
<span class="co">#&gt; 3  3       1        0  European 1953-08-03     1  1.2431679  0.183656473</span>
<span class="co">#&gt; 4  3       1        0  European 1953-08-03     2  0.9569143  0.185134324</span>
<span class="co">#&gt; 5  3       1        0  European 1953-08-03     3  1.0044586 -0.391911821</span>
<span class="co">#&gt; 6  4       0        0   Pacific 1959-07-07     1  0.2846879 -0.080660875</span>
<span class="co">#&gt;   response_time_tchdl_stnd response_time_sbp_stnd event_status event_time</span>
<span class="co">#&gt; 1                 62.58727               62.57906            1   60.73112</span>
<span class="co">#&gt; 2                 57.26762               57.21561            0   66.07927</span>
<span class="co">#&gt; 3                 60.87611               60.79671            0   66.10580</span>
<span class="co">#&gt; 4                 56.50376               56.46817            0   66.10580</span>
<span class="co">#&gt; 5                 63.93977               63.92608            0   66.10580</span>
<span class="co">#&gt; 6                 51.83299               51.81109            0   61.74113</span></code></pre></div>
<p>Looking further at these datasets we see that there are 3000 patients in this study, each with an average of 3.0103333 assessments.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">data_repeat_outcomes</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 3000</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">data_repeat_outcomes</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 3.010333</span></code></pre></div>
<p>Moreover, we can see the breakdown of events</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">data_repeat_outcomes</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>,<span class="st">"event_status"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">[</span>,<span class="st">"event_status"</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    0    1    2 </span>
<span class="co">#&gt; 2538  429   33</span></code></pre></div>
<p>So 429 patients in the study (out of 3000) experienced a CVD event and 33 experienced death from other causes.</p>
</div>
<div id="analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#analysis" class="anchor" aria-hidden="true"></a>Analysis</h2>
<p>We are now ready to begin the analysis using the Landmarking package.</p>
<p>There are a couple of issues to deal with before we start, these stem from the fact that we wish to compare the LOCF and LME longitudinal model. We want to ensure that the same dataset is used for both of these models so that the comparison is fair.</p>
<p>The first issue is that the presence of <code>NA</code> values means that some individuals in the risk set do not have LOCF values for all the covariates. This means that the LOCF longitudinal model cannot be fitted for these individuals, however the LME longitudinal model can allow missing values in the random effects covariates. As we wish that the dataset that both models are fitted are the same, we should consider removing these individuals from the dataset.</p>
<p>Helpfully, the <code>Landmarking</code> package contains a function <code>return_ids_with_LOCF</code> to create a dataset with individuals with a LOCF for all covariates contained in the <code>covariates</code> parameter at landmark time <code>x_L</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_repeat_outcomes</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="../reference/return_ids_with_LOCF.html">return_ids_with_LOCF</a></span><span class="op">(</span>
    data_long <span class="op">=</span> <span class="va">data_repeat_outcomes</span>,
    individual_id <span class="op">=</span> <span class="st">"id"</span>,
    covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ethnicity"</span>, <span class="st">"smoking"</span>, <span class="st">"diabetes"</span>, <span class="st">"sbp_stnd"</span>, <span class="st">"tchdl_stnd"</span><span class="op">)</span>,
    covariates_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"response_time_sbp_stnd"</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"response_time_tchdl_stnd"</span><span class="op">)</span>,
    x_L <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">60</span>, <span class="fl">61</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<p>The second issue is to do with cross-validation, but we will deal with this once we have fitted the LOCF landmark model.</p>
<p>So we can now fit the landmark model using the LOCF longitudinal submodel. To demonstrate how to use the package, we use only landmark times 60 and 61 years old however we may wish to use more landmark times in practice. For more information about this function, see the Details section of the <code>fit_LOCF_landmark_model</code> documentation.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_model_landmark_LOCF</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="../reference/fit_LOCF_landmark.html">fit_LOCF_landmark</a></span><span class="op">(</span>
    data_long <span class="op">=</span> <span class="va">data_repeat_outcomes</span>,
    x_L <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">60</span>, <span class="fl">61</span><span class="op">)</span>,
    x_hor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">65</span>, <span class="fl">66</span><span class="op">)</span>,
    covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ethnicity"</span>, <span class="st">"smoking"</span>, <span class="st">"diabetes"</span>, <span class="st">"sbp_stnd"</span>, <span class="st">"tchdl_stnd"</span><span class="op">)</span>,
    covariates_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"response_time_sbp_stnd"</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"response_time_tchdl_stnd"</span><span class="op">)</span>,
    k <span class="op">=</span> <span class="fl">10</span>,
    individual_id <span class="op">=</span> <span class="st">"id"</span>,
    event_time <span class="op">=</span> <span class="st">"event_time"</span>,
    event_status <span class="op">=</span> <span class="st">"event_status"</span>,
    survival_submodel <span class="op">=</span> <span class="st">"cause_specific"</span>
  <span class="op">)</span>
<span class="co">#&gt; Warning in FUN(X[[i]], ...): 132 individuals have been removed from the model</span>
<span class="co">#&gt; building as they are not in the risk set at landmark age 61</span>
<span class="co">#&gt; [1] "Fitting longitudinal submodel, landmark age 60"</span>
<span class="co">#&gt; [1] "Complete, landmark age 60"</span>
<span class="co">#&gt; [1] "Fitting survival submodel, landmark age 60"</span>
<span class="co">#&gt; Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :</span>
<span class="co">#&gt; Loglik converged before variable 2,4 ; coefficient may be infinite.</span>
<span class="co">#&gt; Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :</span>
<span class="co">#&gt; Loglik converged before variable 2 ; coefficient may be infinite.</span>
<span class="co">#&gt; Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :</span>
<span class="co">#&gt; Loglik converged before variable 1,3,4 ; coefficient may be infinite.</span>
<span class="co">#&gt; Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :</span>
<span class="co">#&gt; Loglik converged before variable 2 ; coefficient may be infinite.</span>

<span class="co">#&gt; Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :</span>
<span class="co">#&gt; Loglik converged before variable 2 ; coefficient may be infinite.</span>

<span class="co">#&gt; Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :</span>
<span class="co">#&gt; Loglik converged before variable 2 ; coefficient may be infinite.</span>

<span class="co">#&gt; Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :</span>
<span class="co">#&gt; Loglik converged before variable 2 ; coefficient may be infinite.</span>

<span class="co">#&gt; Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :</span>
<span class="co">#&gt; Loglik converged before variable 2 ; coefficient may be infinite.</span>

<span class="co">#&gt; Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :</span>
<span class="co">#&gt; Loglik converged before variable 2 ; coefficient may be infinite.</span>

<span class="co">#&gt; Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :</span>
<span class="co">#&gt; Loglik converged before variable 2 ; coefficient may be infinite.</span>
<span class="co">#&gt; [1] "Complete, landmark age 60"</span>
<span class="co">#&gt; [1] "Fitting longitudinal submodel, landmark age 61"</span>
<span class="co">#&gt; [1] "Complete, landmark age 61"</span>
<span class="co">#&gt; [1] "Fitting survival submodel, landmark age 61"</span>
<span class="co">#&gt; Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :</span>
<span class="co">#&gt; Loglik converged before variable 1,3 ; coefficient may be infinite.</span>
<span class="co">#&gt; Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :</span>
<span class="co">#&gt; Loglik converged before variable 1,3,4 ; coefficient may be infinite.</span>

<span class="co">#&gt; Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :</span>
<span class="co">#&gt; Loglik converged before variable 1,3,4 ; coefficient may be infinite.</span>

<span class="co">#&gt; Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :</span>
<span class="co">#&gt; Loglik converged before variable 1,3,4 ; coefficient may be infinite.</span>

<span class="co">#&gt; Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :</span>
<span class="co">#&gt; Loglik converged before variable 1,3,4 ; coefficient may be infinite.</span>

<span class="co">#&gt; Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :</span>
<span class="co">#&gt; Loglik converged before variable 1,3,4 ; coefficient may be infinite.</span>

<span class="co">#&gt; Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :</span>
<span class="co">#&gt; Loglik converged before variable 1,3,4 ; coefficient may be infinite.</span>

<span class="co">#&gt; Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :</span>
<span class="co">#&gt; Loglik converged before variable 1,3,4 ; coefficient may be infinite.</span>

<span class="co">#&gt; Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :</span>
<span class="co">#&gt; Loglik converged before variable 1,3,4 ; coefficient may be infinite.</span>

<span class="co">#&gt; Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :</span>
<span class="co">#&gt; Loglik converged before variable 1,3,4 ; coefficient may be infinite.</span>
<span class="co">#&gt; [1] "Complete, landmark age 61"</span></code></pre></div>
<p>We can see that fitting this model returns the warnings such as <code>Loglik converged before variable  2 ; coefficient may be infinite.</code>. Taking a look at the model fit contained in <code>data_model_landmark_LOCF$model_survival</code>, we can see the confidence intervals for certain folds is very large. This is due there being few observations for these covariates. However, as only the point estimate of the coefficient is needed to calculate the risk prediction, inaccurate standard error values is not a problem. Indeed we have obtained the risk predictions and can take a look at their distribution.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="va">data_model_landmark_LOCF</span><span class="op">[[</span><span class="st">"60"</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">event_prediction</span><span class="op">)</span>,
  xlab <span class="op">=</span> <span class="st">"Predicted risk of CVD event (%)"</span>,
  main <span class="op">=</span> <span class="st">"Landmark age 60"</span>
<span class="op">)</span></code></pre></div>
<p><img src="how_to_use_files/figure-html/12-1.png" width="700"></p>
<p>Printing the object that has been outputted returns a list of datasets corresponding to each of the landmark groups. These contain the column <code>event_prediction</code> which indicates the risk prediction of the event of interest.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_model_landmark_LOCF</span>
<span class="co">#&gt; $`60`</span>
<span class="co">#&gt;   id smoking diabetes           ethnicity    sbp_stnd   tchdl_stnd</span>
<span class="co">#&gt; 1  2       0        0            European -0.67013418  0.005126055</span>
<span class="co">#&gt; 2  3       1        0            European  0.95691425  0.185134324</span>
<span class="co">#&gt; 3  4       0        0             Pacific  0.28468785 -0.080660875</span>
<span class="co">#&gt; 4  6       0        0             Pacific  0.01195977 -0.009527314</span>
<span class="co">#&gt; 5  8       1        0 Chinese_other_asian  0.57615543 -0.263779371</span>
<span class="co">#&gt; 6  9       1        0 Chinese_other_asian  0.68745060  0.314483754</span>
<span class="co">#&gt;   cross_validation_number event_status event_time event_prediction</span>
<span class="co">#&gt; 1                       5            0   65.00000       0.18372278</span>
<span class="co">#&gt; 2                      10            0   65.00000       0.15278193</span>
<span class="co">#&gt; 3                       8            0   61.74113       0.10378522</span>
<span class="co">#&gt; 4                       8            0   61.81972       0.11601665</span>
<span class="co">#&gt; 5                       4            0   65.00000       0.09842226</span>
<span class="co">#&gt; 6                      10            0   63.07539       0.08866377</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $`61`</span>
<span class="co">#&gt;   id smoking diabetes           ethnicity    sbp_stnd   tchdl_stnd</span>
<span class="co">#&gt; 1  2       0        0            European -0.67013418  0.005126055</span>
<span class="co">#&gt; 2  3       1        0            European  1.24316786  0.183656473</span>
<span class="co">#&gt; 3  4       0        0             Pacific  0.28468785 -0.080660875</span>
<span class="co">#&gt; 4  6       0        0             Pacific  0.01195977 -0.009527314</span>
<span class="co">#&gt; 5  8       1        0 Chinese_other_asian  0.57615543 -0.263779371</span>
<span class="co">#&gt; 6  9       1        0 Chinese_other_asian  0.68745060  0.314483754</span>
<span class="co">#&gt;   cross_validation_number event_status event_time event_prediction</span>
<span class="co">#&gt; 1                       5            0   66.00000        0.1436272</span>
<span class="co">#&gt; 2                      10            0   66.00000        0.1563242</span>
<span class="co">#&gt; 3                       8            0   61.74113        0.1259180</span>
<span class="co">#&gt; 4                       8            0   61.81972        0.1325977</span>
<span class="co">#&gt; 5                       4            0   66.00000        0.1124857</span>
<span class="co">#&gt; 6                      10            0   63.07539        0.1247429</span></code></pre></div>
<p>The output also contains the prediction error for the model, which is assessed using the Brier score and C-index. The standard error for these estimates can be calculated by setting parameter <code>b</code> to the desired number of bootstrap samples.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_model_landmark_LOCF</span><span class="op">[[</span><span class="st">"60"</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">prediction_error</span>
<span class="co">#&gt; $c_index</span>
<span class="co">#&gt; [1] 0.6336452</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $c_index_standard_error</span>
<span class="co">#&gt; [1] NA</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $brier_score</span>
<span class="co">#&gt; [1] 0.1113331</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $brier_score_standard_error</span>
<span class="co">#&gt; [1] NA</span>
<span class="va">data_model_landmark_LOCF</span><span class="op">[[</span><span class="st">"61"</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">prediction_error</span>
<span class="co">#&gt; $c_index</span>
<span class="co">#&gt; [1] 0.5757325</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $c_index_standard_error</span>
<span class="co">#&gt; [1] NA</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $brier_score</span>
<span class="co">#&gt; [1] 0.1099324</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $brier_score_standard_error</span>
<span class="co">#&gt; [1] NA</span></code></pre></div>
<p>In order to assess the performance of the model, there is also the <code>plot</code> method which creates a calibration plot which can assess the calibration of the model. The perfect prediction model will have points along the y=x line and deviations from this suggest poor calibration.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">data_model_landmark_LOCF</span>, x_L <span class="op">=</span> <span class="fl">60</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<p><img src="how_to_use_files/figure-html/20-1.png" width="700"></p>
<p>Now we can move on to fitting the landmark model using the LME longitudinal submodel. For more information about this function, see the Details section of the <code>fit_LME_landmark_model</code> documentation. The variables standardised systolic blood pressure (SBP) and standardised total cholesterol to high density lipoprotein (HDL) ratio are continuous and repeatedly measured and so these are included as random effects in the LME model.</p>
<p>The second issue which was mentioned previously is related to cross-validation. In particular we wish to perform k-fold cross-validation using exactly the same folds for both LOCF and LME models to ensure a fair comparison. To do this we use the parameter <code>cross_validation_df</code> which uses a list of data frames that indicate which fold each individual belongs to. We create this list using the output of <code>fit_LOCF_landmark_model</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cross_validation_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">data_model_landmark_LOCF</span>, <span class="st">"[["</span>, i <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>There are a couple of computational considerations to highlight about fitting the LME model. The parameter <code>lme_control</code> can be altered in order to change the default values of parameters (such as maximum number of iterations) for the algorithm which fits the LME model. Also setting <code>standardise_time = TRUE</code> standardises the values of the time variable and this helps fitting the LME model (see <code>?fit_LME_landmark_model</code>).</p>
<p>We fit the LME landmark model in a similar way to the LOCF landmark model, but with a few extra parameters. Fitting the LME model can take some time so here we only use landmark age 60 for demonstration purposes.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_model_landmark_LME</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="../reference/fit_LME_landmark.html">fit_LME_landmark</a></span><span class="op">(</span>
    data_long <span class="op">=</span> <span class="va">data_repeat_outcomes</span><span class="op">[[</span><span class="st">"60"</span><span class="op">]</span><span class="op">]</span>,
    x_L <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">60</span><span class="op">)</span>,
    x_hor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">65</span><span class="op">)</span>,
    cross_validation_df <span class="op">=</span>
      <span class="va">cross_validation_list</span>,
    fixed_effects <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ethnicity"</span>, <span class="st">"smoking"</span>, <span class="st">"diabetes"</span><span class="op">)</span>,
    fixed_effects_time <span class="op">=</span>
      <span class="st">"response_time_sbp_stnd"</span>,
    random_effects <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sbp_stnd"</span>, <span class="st">"tchdl_stnd"</span><span class="op">)</span>,
    random_effects_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"response_time_sbp_stnd"</span>, <span class="st">"response_time_tchdl_stnd"</span><span class="op">)</span>,
    individual_id <span class="op">=</span> <span class="st">"id"</span>,
    standardise_time <span class="op">=</span> <span class="cn">TRUE</span>,
    lme_control <span class="op">=</span> <span class="fu">nlme</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/lmeControl.html" class="external-link">lmeControl</a></span><span class="op">(</span>maxIter <span class="op">=</span>
                                     <span class="fl">100</span>, msMaxIter <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>,
    event_time <span class="op">=</span> <span class="st">"event_time"</span>,
    event_status <span class="op">=</span> <span class="st">"event_status"</span>,
    survival_submodel <span class="op">=</span> <span class="st">"cause_specific"</span>
  <span class="op">)</span>
<span class="co">#&gt; [1] "Fitting longitudinal submodel, landmark age 60"</span>
<span class="co">#&gt; [1] "Complete, landmark age 60"</span>
<span class="co">#&gt; [1] "Fitting survival submodel, landmark age 60"</span>
<span class="co">#&gt; Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :</span>
<span class="co">#&gt; Loglik converged before variable 2,4 ; coefficient may be infinite.</span>
<span class="co">#&gt; Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :</span>
<span class="co">#&gt; Loglik converged before variable 2 ; coefficient may be infinite.</span>
<span class="co">#&gt; Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :</span>
<span class="co">#&gt; Loglik converged before variable 1,3,4 ; coefficient may be infinite.</span>
<span class="co">#&gt; Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :</span>
<span class="co">#&gt; Loglik converged before variable 2 ; coefficient may be infinite.</span>

<span class="co">#&gt; Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :</span>
<span class="co">#&gt; Loglik converged before variable 2 ; coefficient may be infinite.</span>

<span class="co">#&gt; Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :</span>
<span class="co">#&gt; Loglik converged before variable 2 ; coefficient may be infinite.</span>

<span class="co">#&gt; Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :</span>
<span class="co">#&gt; Loglik converged before variable 2 ; coefficient may be infinite.</span>

<span class="co">#&gt; Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :</span>
<span class="co">#&gt; Loglik converged before variable 2 ; coefficient may be infinite.</span>

<span class="co">#&gt; Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :</span>
<span class="co">#&gt; Loglik converged before variable 2 ; coefficient may be infinite.</span>

<span class="co">#&gt; Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :</span>
<span class="co">#&gt; Loglik converged before variable 2 ; coefficient may be infinite.</span>
<span class="co">#&gt; [1] "Complete, landmark age 60"</span></code></pre></div>
<p>Comparing the prediction error for the landmarking with LOCF and LME, we can see a slight improvement when the LME model is used.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_model_landmark_LOCF</span><span class="op">[[</span><span class="st">"60"</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">prediction_error</span>
<span class="co">#&gt; $c_index</span>
<span class="co">#&gt; [1] 0.6336452</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $c_index_standard_error</span>
<span class="co">#&gt; [1] NA</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $brier_score</span>
<span class="co">#&gt; [1] 0.1113331</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $brier_score_standard_error</span>
<span class="co">#&gt; [1] NA</span>
<span class="va">data_model_landmark_LME</span><span class="op">[[</span><span class="st">"60"</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">prediction_error</span>
<span class="co">#&gt; $c_index</span>
<span class="co">#&gt; [1] 0.7550631</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $c_index_standard_error</span>
<span class="co">#&gt; [1] NA</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $brier_score</span>
<span class="co">#&gt; [1] 0.08802139</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $brier_score_standard_error</span>
<span class="co">#&gt; [1] NA</span></code></pre></div>
<p>Finally, suppose that we wish to predict the risk of the event of interest for a new patient. We need to create a data frame that contains records of all the covariates that were used to form the landmark model. As cross-validation was used, it is necessary to specify which cross-validation fold to use in the prediction. It is possible to predict the risk of the event of interest at any time before the horizon time.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">newdata</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>
    id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3001</span>, <span class="fl">3001</span>, <span class="fl">3001</span><span class="op">)</span>,
    response_time_sbp_stnd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">57</span>, <span class="fl">58</span>, <span class="fl">59</span><span class="op">)</span>,
    smoking <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,
    diabetes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,
    ethnicity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Indian"</span>, <span class="st">"Indian"</span>, <span class="st">"Indian"</span><span class="op">)</span>,
    sbp_stnd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.45</span>, <span class="fl">0.87</span>, <span class="fl">0.85</span><span class="op">)</span>,
    tchdl_stnd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.7</span>, <span class="fl">0.24</span>, <span class="fl">0.3</span><span class="op">)</span>,
    response_time_tchdl_stnd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">57</span>, <span class="fl">58</span>, <span class="fl">59</span><span class="op">)</span>
  <span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span>
  object <span class="op">=</span> <span class="va">data_model_landmark_LME</span>,
  x_L <span class="op">=</span> <span class="fl">60</span>,
  x_hor <span class="op">=</span> <span class="fl">62</span>,
  newdata <span class="op">=</span> <span class="va">newdata</span>,
  cv_fold <span class="op">=</span> <span class="fl">1</span>
<span class="op">)</span>
<span class="co">#&gt;      id ethnicity smoking diabetes  sbp_stnd  tchdl_stnd sbp_stnd_slope</span>
<span class="co">#&gt; 1: 3001    Indian       0        0 0.5582313 -0.02973252     0.02788248</span>
<span class="co">#&gt;    tchdl_stnd_slope event_prediction</span>
<span class="co">#&gt; 1:      -0.01839017       0.04339261</span>
<span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span>
  object <span class="op">=</span> <span class="va">data_model_landmark_LME</span>,
  x_L <span class="op">=</span> <span class="fl">60</span>,
  x_hor <span class="op">=</span> <span class="fl">64</span>,
  newdata <span class="op">=</span> <span class="va">newdata</span>,
  cv_fold <span class="op">=</span> <span class="fl">1</span>
<span class="op">)</span>
<span class="co">#&gt;      id ethnicity smoking diabetes  sbp_stnd  tchdl_stnd sbp_stnd_slope</span>
<span class="co">#&gt; 1: 3001    Indian       0        0 0.5582313 -0.02973252     0.02788248</span>
<span class="co">#&gt;    tchdl_stnd_slope event_prediction</span>
<span class="co">#&gt; 1:      -0.01839017       0.07621137</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Isobel Barrott, Jessica Barrett.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link external-link">pkgdown</a> 1.6.1.9001.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
