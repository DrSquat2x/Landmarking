<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Fit a landmarking model using a linear mixed effects (LME) model for the longitudinal data — fit_LME_longitudinal • Landmarking</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Fit a landmarking model using a linear mixed effects (LME) model for the longitudinal data — fit_LME_longitudinal" />
<meta property="og:description" content="This function is a helper function for fit_LME_landmark." />






<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  

  

  </head>

  <body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-standard navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Landmarking</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/Landmarking.html">Introduction to Landmark Models and the R package Landmarking</a>
    </li>
    <li>
      <a href="../articles/how_to_use.html">How to use the R package 'Landmarking'</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/isobelbarrott/Landmarking/">
    <span class="fa fa-github fa-lg"></span>
     
    github
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    Functions
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fit a landmarking model using a linear mixed effects (LME) model for the longitudinal data</h1>
    <small class="dont-index">Source: <a href='https://github.com/isobelbarrott/Landmarking/blob/master/R/fit_LME_landmark.R'><code>R/fit_LME_landmark.R</code></a></small>
    <div class="hidden name"><code>fit_LME_longitudinal.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function is a helper function for <code>fit_LME_landmark</code>.</p>
    </div>

    <div class="ref-usage sourceCode"><pre class='sourceCode r'><code><span class='fu'>fit_LME_longitudinal</span><span class='op'>(</span>
  <span class='va'>data_long</span>,
  <span class='va'>x_L</span>,
  <span class='va'>predictors_LME</span>,
  <span class='va'>responses_LME</span>,
  <span class='va'>predictors_LME_time</span>,
  <span class='va'>responses_LME_time</span>,
  standardise_time <span class='op'>=</span> <span class='cn'>FALSE</span>,
  random_slope_longitudinal <span class='op'>=</span> <span class='cn'>TRUE</span>,
  random_slope_survival <span class='op'>=</span> <span class='cn'>TRUE</span>,
  include_data_after_x_L <span class='op'>=</span> <span class='cn'>TRUE</span>,
  cv_name <span class='op'>=</span> <span class='cn'>NA</span>,
  <span class='va'>individual_id</span>,
  lme_control <span class='op'>=</span> <span class='fu'>nlme</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/nlme/man/lmeControl.html'>lmeControl</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='op'>)</span></code></pre></div>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data_long</th>
      <td><p>Data frame containing repeat measurement data and time-to-event data in long format.</p></td>
    </tr>
    <tr>
      <th>x_L</th>
      <td><p>Numeric specifying the landmark time(s)</p></td>
    </tr>
    <tr>
      <th>predictors_LME</th>
      <td><p>Vector of character strings specifying the column names in <code>data_long</code>
which correspond to the predictor variables in the LME model</p></td>
    </tr>
    <tr>
      <th>responses_LME</th>
      <td><p>Vector of character strings specifying the column names in <code>data_long</code>
which correspond to the response variables in the LME model</p></td>
    </tr>
    <tr>
      <th>predictors_LME_time</th>
      <td><p>Vector of character strings specifying the column names in <code>data_long</code>
which contains the time at which the predictor variables were recorded.
This should either be length 1 or the same length as <code>predictors_LME</code>.
In the latter case the order of elements must correspond to the order of elements in <code>predictors_LME</code>.</p></td>
    </tr>
    <tr>
      <th>responses_LME_time</th>
      <td><p>Vector of character strings specifying the column names in <code>data_long</code>
which contain the times at which response variables were recorded. This should either be length 1 or
the same length as <code>responses_LME</code>. In the latter case the order of elements must correspond to the
order of elements in <code>responses_LME</code>.</p></td>
    </tr>
    <tr>
      <th>standardise_time</th>
      <td><p>Boolean indicating whether to standardise the time variable in the LME model by subtracting the mean
and dividing by the standard deviation. See Details section of <code>fit_LME_longitudinal</code> for more information.</p></td>
    </tr>
    <tr>
      <th>random_slope_longitudinal</th>
      <td><p>Boolean indicating whether to include a random slope in the LME model. See Details section of <code>fit_LME_longitudinal</code> for more information.</p></td>
    </tr>
    <tr>
      <th>random_slope_survival</th>
      <td><p>Boolean indicating whether to include the random slope estimate from the LME model
as a covariate in the survival submodel. See Details section of <code>fit_LME_longitudinal</code> for more information.</p></td>
    </tr>
    <tr>
      <th>include_data_after_x_L</th>
      <td><p>Boolean indicating whether to include all longitudinal data, including data after the landmark age <code>x_L</code>,
in the model development dataset. See Details section of <code>fit_LME_longitudinal</code> for more information.</p></td>
    </tr>
    <tr>
      <th>cv_name</th>
      <td><p>Character string specifying the column name in <code>data_long</code> that indicates cross-validation fold</p></td>
    </tr>
    <tr>
      <th>individual_id</th>
      <td><p>Character string specifying the column name in <code>data_long</code> which contains the individual identifiers</p></td>
    </tr>
    <tr>
      <th>lme_control</th>
      <td><p>Object created using <code><a href='https://rdrr.io/pkg/nlme/man/lmeControl.html'>nlme::lmeControl()</a></code>, which will be passed to the <code>control</code> argument of the <code>lme</code> function</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>List containing elements:
<code>data_longitudinal</code>, <code>model_longitudinal</code>, <code>model_LME</code>, and <code>model_LME_standardise_time</code>.</p>
<p><code>data_longitudinal</code> has one row for each individual in the risk set at <code>x_L</code> and
contains the value of the covariates at the landmark time <code>x_L</code> of the <code>predictors_LME</code> using the LOCF model and
<code>responses_LME</code> using the LME model.</p>
<p><code>model_longitudinal</code> indicates that the LME approach is used.</p>
<p><code>model_LME</code> contains the output from
the <code>lme</code> function from package <code>nlme</code>. For a model using cross-validation,
<code>model_LME</code> contains a list of outputs with each
element in the list corresponds to a different cross-validation fold.</p>
<p><code>model_LME_standardise_time</code> contains a list of two objects <code>mean_response_time</code> and <code>sd_response_time</code> if the parameter <code>standardise_time=TRUE</code> is used. This
is the mean and standard deviation used to normalise times when fitting the LME model.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>For an individual \(i\), the LME model can be written as</p>
<p>$$Y_i = X_i \beta + Z_i U_i + \epsilon_i$$</p>
<p>where</p><ul>
<li><p>\(Y_i\) is the vector of responses at different time points for the individual</p></li>
<li><p>\(X_i\) is the matrix of predictors for the fixed effects at these time points</p></li>
<li><p>\(\beta\) is the vector of coefficients for the fixed effects</p></li>
<li><p>\(Z_i\) is the matrix of predictors for the random effects</p></li>
<li><p>\(U_i\) is the matrix of coefficients for the random effects</p></li>
<li><p>\(\epsilon_i\) is the error term, typically from N(0, \(\sigma\))</p></li>
</ul>

<p>By using an LME model to fit repeat measures data, rather than a linear model, we can allow measurements from the same individuals to be
more similar than measurements from different individuals. This is done through the random intercept and/or
random slope.</p>
<p>Extending this model to the case where there are multiple random effects, denoted \(k\), we have</p>
<p>$$Y_{ik} = X_{ik} \beta_k + Z_{ik} U_{ik} + \epsilon_{ik}$$</p>
<p>Typically the random effects are assumed to be from the multivariate normal (MVN) distribution \(MVN(0,\Sigma_u)\)
and we choose a certain covariance structure for \(\Sigma_u\). The function <code>fit_LME_landmark</code> uses this distribution with
unstructured covariance for the random effects when fitting the LME model (i.e. no constraints are imposed on the values).</p>
<p>To fit the LME model the function <code>lme</code> from the package <code>nlme</code> is used.
The random intercept is always included in the LME model.
Additionally, the random slope can be included in the LME model using the parameter <code>random_slope_longitudinal=TRUE</code>.</p>
<p>It is important to distinguish between the validation set and the development set for fitting the LME model in this function.
The development dataset either includes all the repeat measurements (including those after the landmark age <code>x_L</code>), or only the repeat measurements
recorded up to and including the landmark age <code>x_L</code>. This is controlled using the parameter <code>include_data_after_x_L</code>.
The validation set only includes the repeat measurements recorded up until and including the landmark age <code>x_L</code>,
i.e. it does not include future data in its predictions.</p>
<p>Using the fitted model, the values of the best linear unbiased predictions (BLUPs)
at the landmark age <code>x_L</code> are calculated. These BLUPs are the predictions of the values of the <code>responses_LME</code>
the landmark age <code>x_L</code>. The values of the predictors in this prediction are the LOCF values of the <code>predictors_LME</code>
at the landmark age <code>x_L</code>. In the function <code>fit_LME_landmark</code>, these predictions are used as covariates in the survival
model along with the LOCF values of  <code>predictors_LME</code>. Additionally, the estimated value of the random slope can
be included as predictors in the survival model using the parameter <code>random_slope_survival=TRUE</code>.</p>
<p>There is an important consideration about fitting the linear mixed effects model. As the variable <code>responses_LME_time</code>
gets further from 0, the random effects coefficients get closer to 0. This causes computational issues
as the elements in the covariance matrix of the random effects, \(\Sigma_u\), are constrained to
be greater than 0. Using parameter <code>standard_time=TRUE</code> can prevent this issue by standardising the
time variables to ensure that the <code>responses_LME_time</code> values are not too close to 0.</p>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p><p>Developed by Isobel Barrott, Jessica Barrett.</p></p>
</div>

<div class="pkgdown">
  <p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.6.1.9001.</p></p>
</div>

      </footer>
   </div>

  


  

  </body>
</html>


