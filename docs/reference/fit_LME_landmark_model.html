<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Fit a landmarking model using a linear mixed effects (LME) model for the longitudinal submodel — fit_LME_landmark_model • Landmarking</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Fit a landmarking model using a linear mixed effects (LME) model for the longitudinal submodel — fit_LME_landmark_model" />
<meta property="og:description" content="This function performs the two-stage landmarking analysis. In the first stage the longitudinal submodel is fitted using the LME model and in the
second stage the survival submodel is fitted.
Integer specifying the number of bootstrap samples to take" />






<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  

  

  </head>

  <body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-standard navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Landmarking</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/Landmarking.html">Introduction to Landmark Models</a>
    </li>
    <li>
      <a href="../articles/how_to_use.html">How to use the R package ‘Landmarking’</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://https://github.com/isobelbarrott/Landmarking/">
    <span class="fa fa-github fa-lg"></span>
     
    github
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fit a landmarking model using a linear mixed effects (LME) model for the longitudinal submodel</h1>
    <small class="dont-index">Source: <a href='https://github.com/isobelbarrott/Landmarking/blob/master/R/fit_landmark_model.R'><code>R/fit_landmark_model.R</code></a></small>
    <div class="hidden name"><code>fit_LME_landmark_model.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function performs the two-stage landmarking analysis. In the first stage the longitudinal submodel is fitted using the LME model and in the
second stage the survival submodel is fitted.
Integer specifying the number of bootstrap samples to take</p>
    </div>

    <div class="ref-usage sourceCode"><pre class='sourceCode r'><code><span class='fu'>fit_LME_landmark_model</span><span class='op'>(</span>
  <span class='va'>data_long</span>,
  <span class='va'>x_L</span>,
  <span class='va'>x_hor</span>,
  <span class='va'>fixed_effects</span>,
  <span class='va'>random_effects</span>,
  <span class='va'>fixed_effects_time</span>,
  <span class='va'>random_effects_time</span>,
  random_slope <span class='op'>=</span> <span class='cn'>TRUE</span>,
  standardise_time <span class='op'>=</span> <span class='cn'>FALSE</span>,
  <span class='va'>patient_id</span>,
  <span class='va'>start_study_time</span>,
  <span class='va'>end_study_time</span>,
  <span class='va'>k</span>,
  <span class='va'>cross_validation_df</span>,
  lme_control <span class='op'>=</span> <span class='fu'>nlme</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/nlme/man/lmeControl.html'>lmeControl</a></span><span class='op'>(</span><span class='op'>)</span>,
  <span class='va'>event_time</span>,
  <span class='va'>event_status</span>,
  survival_submodel <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"standard_cox"</span>, <span class='st'>"cause_specific"</span>, <span class='st'>"fine_gray"</span><span class='op'>)</span>,
  <span class='va'>b</span>
<span class='op'>)</span></code></pre></div>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data_long</th>
      <td><p>Data frame containing repeat measurements data and time-to-event data in long format</p></td>
    </tr>
    <tr>
      <th>x_L</th>
      <td><p>Numeric specifying the landmark time</p></td>
    </tr>
    <tr>
      <th>x_hor</th>
      <td><p>Numeric specifying the horizon time</p></td>
    </tr>
    <tr>
      <th>fixed_effects</th>
      <td><p>Vector of character strings specifying the column names in <code>data</code>
which correspond to the fixed effects</p></td>
    </tr>
    <tr>
      <th>random_effects</th>
      <td><p>Vector of character strings specifying the column names in <code>data</code>
which correspond to the random effects</p></td>
    </tr>
    <tr>
      <th>fixed_effects_time</th>
      <td><p>Character string specifying the column name in <code>data</code>
which contains the time at which the fixed effects were recorded</p></td>
    </tr>
    <tr>
      <th>random_effects_time</th>
      <td><p>Vector of character strings specifying the column names in <code>data</code>
which contain the times at which repeat measures were recorded. This should either be length 1 or
the same length as <code>random_effects</code>. In the latter case the order of elements must correspond to the
order of elements in <code>random_effects</code>.</p></td>
    </tr>
    <tr>
      <th>random_slope</th>
      <td><p>Boolean indicating whether to include a random slope in the LME model</p></td>
    </tr>
    <tr>
      <th>standardise_time</th>
      <td><p>Boolean indicating whether to standarise the time variable by subtracting the mean
and dividing by the standard deviation (see Details section for more information)</p></td>
    </tr>
    <tr>
      <th>patient_id</th>
      <td><p>Character string specifying the column name in <code>data</code> which contains the individual identifiers</p></td>
    </tr>
    <tr>
      <th>start_study_time</th>
      <td><p>Character string specifying the column name in <code>data</code> which indicates the time that an individual enters the study</p></td>
    </tr>
    <tr>
      <th>end_study_time</th>
      <td><p>Character string specifying the column name in <code>data</code> which indicates the time that an individual leaves the study</p></td>
    </tr>
    <tr>
      <th>k</th>
      <td><p>Integer specifying the number of folds for cross-validation</p></td>
    </tr>
    <tr>
      <th>cross_validation_df</th>
      <td><p>List of dataframes containing the cross-validation fold each individual is assigned to. Each dataframe in the list should be
named according to the landmark time x_L that they correspond. Each dataframe should contain the columns <code>patient_id</code> and a column <code>"cross_validation_number"</code> which contains the cross-validation fold of the individual.</p></td>
    </tr>
    <tr>
      <th>lme_control</th>
      <td><p>Object created using <code><a href='https://rdrr.io/pkg/nlme/man/lmeControl.html'>nlme::lmeControl()</a></code>, which will be passed to the <code>control</code> argument of the <code>lme</code>
function</p></td>
    </tr>
    <tr>
      <th>event_time</th>
      <td><p>Character string specifying the column name in <code>data</code>
which contains the event time</p></td>
    </tr>
    <tr>
      <th>event_status</th>
      <td><p>Character string specifying the column name in <code>data</code>
which contains the event status (where 0=censoring, 1=event of interest, if there are competing events these are labelled
2 or above.)</p></td>
    </tr>
    <tr>
      <th>survival_submodel</th>
      <td><p>Character string specifying which survival submodel to
use. Three options: the standard Cox model i.e. no competing risks (<code>"standard_cox"</code>),
the cause-specific regression model (<code>"cause_specific"</code>), or the Fine Gray
regression model (<code>"fine_gray"</code>)</p></td>
    </tr>
    <tr>
      <th>b</th>
      <td><p>Integer specifying the number of bootstrap samples to take when calcluating standard error of c-index and Brier score</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>List containing <code>data</code>, <code>model_longitudinal</code>, <code>model_LME</code>, <code>model_LME_standardise_time</code>, <code>model_survival</code>, and <code>prediction_error</code>.</p>
<p><code>data</code> is a data frame that includes the LOCF values of the <code>fixed_effects</code> and estimates
of the <code>random_effects</code> predicted from the LME model (see Details section). It also includes the predicted
probability that the event of interest has occured by time <code>x_L</code>, labelled as <code>"event_prediction"</code>.
There is one row for each individual.</p>
<p><code>model_longitudinal</code> indicates that the longitudinal submodel is LME.</p>
<p><code>model_LME</code> contains the output from
the <code>lme</code> function from package <code>nlme</code>. For a model using cross-validation,
<code>model_LME</code> contains a list of outputs with each
element in the list corresponds to a different cross-validation fold.
<code>prediction_error</code> contains a list indicating the c-index and Brier score at time <code>x_hor</code> and their standard errors if parameter <code>b</code> is used.
For more information on how the prediction error is calculated
please see <code><a href='get_model_assessment.html'>?get_model_assessment</a></code> which is the function used to do this within <code>fit_LME_landmark_model</code>.</p>
<p><code>model_LME_standardise_time</code> contains a list of two objects <code>mean_response_time</code> and <code>sd_response_time</code> if the parameter <code>standardise_time=TRUE</code> is used. This
is the mean and standard deviation use to normalise times when fitting the LME model.</p>
<p><code>model_survival</code> contains the outputs from
the survival submodel functions, including the estimated parameters of the model. For a model using cross-validation,
<code>model_survival</code> will contain a list of outputs with each
element in the list corresponding to a different cross-validation fold.
<code>model_survival</code> contains the outputs from the function used to fit the survival submodel, including the estimated parameters of the model.
For a model using cross-validation, <code>model_survival</code> contains a list of outputs with each
element in the list corresponding to a different cross-validation fold. For more information on how the survival model is fitted
please see <code>?fit_survival_model</code> which is the function used to do this within <code>fit_LME_landmark_model</code>.</p>
<p><code>prediction_error</code> contains a list indicating the c-index and Brier score at time <code>x_hor</code> and their standard errors if parameter <code>b</code> is used.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>There are two parts to fitting the landmark model: the longitudinal submodel and the survival submodel.
This function id used to fit the LME model as the longitudinal submodel. This model will be described in more detail.</p>
<p>For an individual \(i\), the LME model can be written as</p>
<p>$$Y_i = X_i \beta + Z_i U_i + \epsilon_i$$</p>
<p>where</p><ul>
<li><p>\(Y_i\) is the vector of outcomes at different time points for the individual</p></li>
<li><p>\(X_i\) is the matrix of covariates for the fixed effects at these time points</p></li>
<li><p>\(\beta\) is the vector of coefficients for the fixed effects</p></li>
<li><p>\(Z_i\) is the matrix of covariates for the random effects</p></li>
<li><p>\(U_i\) is the matrix of coefficients for the random effects</p></li>
<li><p>\(\epsilon_i\) is the error term, typically from N(0, \(\sigma\))</p></li>
</ul>

<p>By using an LME model to fit repeat measures data we can allow measurements from the same individuals to be
more similar than measurements from different individuals. This is done through the random intercept and/or
random slope.</p>
<p>Extending this model to the case where there are multiple random effects, denoted \(k\), we have</p>
<p>$$Y_{ik} = X_{ik} \beta_k + Z_{ik} U_{ik} + \epsilon_{ik}$$</p>
<p>Using this model we can allow a covariance structure within the random effects term \(U_{ik}\), for example a sample from the
multivariate normal (MVN) distribution \(MVN(0,\Sigma_u)\). This covariance structure means the value of one random effects variable informs about the
value of the other random effects variables, leading to more accurate predictions and allowing there to be missing data in the
random effects variables.</p>
<p>The function <code>fit_LME_landmark_model</code> uses this covariance structure for the random effects when fitting the LME model.
To fit the LME model the function <code>lme</code> from the package <code>nlme</code> is used.
The fixed effects are calculated as the LOCF for the variables <code>fixed_effects</code> at the landmark age <code>x_L</code> and the random effects
are those stated in <code>random_effects</code> and at times <code>random_effects_time</code>. This model is used to predict the
values of the random effects at the landmark time <code>x_L</code>.</p>
<p>It is important to distinguish between the validation set and the development set for fitting the LME model. The development set includes
all the repeat measurements (including those after the landmark age <code>x_L</code>). Conversely, the validation set only includes
the repeat measurements recorded up until and including the landmark age <code>x_L</code>.</p>
<p>There is an important consideration about fitting the linear mixed effects model. As the variable <code>random_effects_time</code>
gets further from 0, the random effects coefficients get closer to 0. This causes computational issues
as the elements in the covariance matrix of the random effects, \(\Sigma_u\), are constrained to
be greater than 0. Using parameter <code>standard_time=TRUE</code> can prevent this issue by standardising the
time variables to ensure that the <code>random_effects_time</code> values are not too close to 0.</p>
<p>The predictions of the random effects at the landmark age, in addition to the LOCF values for the fixed effects,
are used as the covariates for the survival submodel.
The values of these covariates can be viewed in the data frame <code>data</code> that are returned by this function.</p>
<p>For the survival submodel, there are three choices of model:</p><ul>
<li><p>the standard Cox model, this is a wrapper function for <code>coxph</code> from the package <code>survival</code></p></li>
<li><p>the cause-specific model, this is a wrapper function for <code>CSC</code> from package <code>riskRegression</code></p></li>
<li><p>the Fine Gray model, this is a wrapper function for <code>FGR</code> from package <code>riskRegression</code></p></li>
</ul>

<p>The latter two models estimate the probability of the event of interest in the presence of competing events.</p>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Isobel Barrott <a href='mailto:isobel.barrott@gmail.com'>isobel.barrott@gmail.com</a></p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <div class="ref-examples sourceCode"><pre class='sourceCode r'><code><span class='r-in'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>data_repeat_outcomes</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>data_model_landmark_LME</span><span class='op'>&lt;-</span><span class='fu'>fit_LME_landmark_model</span><span class='op'>(</span>data_long<span class='op'>=</span><span class='va'>data_repeat_outcomes</span>,</span>
<span class='r-in'>x_L<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>60</span>,<span class='fl'>61</span><span class='op'>)</span>,</span>
<span class='r-in'>x_hor<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>65</span>,<span class='fl'>66</span><span class='op'>)</span>,</span>
<span class='r-in'>k<span class='op'>=</span><span class='fl'>10</span>,</span>
<span class='r-in'>start_study_time<span class='op'>=</span><span class='st'>"start_time"</span>,</span>
<span class='r-in'>end_study_time<span class='op'>=</span><span class='st'>"event_time"</span>,</span>
<span class='r-in'>fixed_effects<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"ethnicity"</span>,<span class='st'>"smoking"</span>,<span class='st'>"diabetes"</span><span class='op'>)</span>,</span>
<span class='r-in'>fixed_effects_time<span class='op'>=</span><span class='st'>"response_time_sbp_stnd"</span>,</span>
<span class='r-in'>random_effects<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"sbp_stnd"</span>,<span class='st'>"tchdl_stnd"</span><span class='op'>)</span>,</span>
<span class='r-in'>random_effects_time<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"response_time_sbp_stnd"</span>,<span class='st'>"response_time_tchdl_stnd"</span><span class='op'>)</span>,</span>
<span class='r-in'>patient_id<span class='op'>=</span><span class='st'>"id"</span>,</span>
<span class='r-in'>standardise_time <span class='op'>=</span> <span class='cn'>TRUE</span>,</span>
<span class='r-in'>lme_control <span class='op'>=</span> <span class='fu'>nlme</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/nlme/man/lmeControl.html'>lmeControl</a></span><span class='op'>(</span>maxIter<span class='op'>=</span><span class='fl'>100</span>,msMaxIter<span class='op'>=</span><span class='fl'>100</span><span class='op'>)</span>,</span>
<span class='r-in'>event_time<span class='op'>=</span><span class='st'>"event_time"</span>,</span>
<span class='r-in'>event_status<span class='op'>=</span><span class='st'>"event_status"</span>,</span>
<span class='r-in'>survival_submodel <span class='op'>=</span> <span class='st'>"cause_specific"</span><span class='op'>)</span></span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> [1] "Fitting longitudinal submodel, landmark age 60"</span>
<span class='r-wrn co'><span class='r-pr'>#&gt;</span> <span class='warning'>Warning: </span>the condition has length &gt; 1 and only the first element will be used</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> [1] "Complete, landmark age 60"</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> [1] "Fitting survival submodel, landmark age 60"</span>
<span class='r-wrn co'><span class='r-pr'>#&gt;</span> <span class='warning'>Warning: </span>Loglik converged before variable  2 ; coefficient may be infinite. </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> [1] "Complete, landmark age 60"</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> [1] "Fitting longitudinal submodel, landmark age 61"</span>
<span class='r-wrn co'><span class='r-pr'>#&gt;</span> <span class='warning'>Warning: </span>the condition has length &gt; 1 and only the first element will be used</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> [1] "Complete, landmark age 61"</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> [1] "Fitting survival submodel, landmark age 61"</span>
<span class='r-wrn co'><span class='r-pr'>#&gt;</span> <span class='warning'>Warning: </span>Loglik converged before variable  2 ; coefficient may be infinite. </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> [1] "Complete, landmark age 61"</span>
<span class='r-in'></span>
</code></pre></div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p><p>Developed by Isobel Barrott, Jessica Barrett.</p></p>
</div>

<div class="pkgdown">
  <p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.6.1.9001.</p></p>
</div>

      </footer>
   </div>

  


  

  </body>
</html>


